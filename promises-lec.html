<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Promises</title>
</head>
<body>

<script>
  "use strict";
  (async function() {
    // explain fetch
    //  we will use instead of .ajax
    //  returns a promise
    // make a simple call and log the promise
      // it is NOT the data :(
    let promise = fetch("docrob/data/inventory.json");
      console.log(promise);

    // explain simply what a promise is
    //  contains the current state of an asynchronous call
    //    starts as Pending and eventually can become resolved (success) or rejected (error)
    //    must use .then to handle resolved and .catch to handle rejected
    //    can use .finally to clean up in both cases
    // change above example to show the response status code of the call
      // and catch to show and handle a 404
      // DON'T CHAIN THEM YET
    promise.then(function(result) {
        console.log(result);
        console.log(result.status);
    });
    promise.catch(function(error) {
        console.log(error);
    });

    // chain the promise methods together
        // show a call to a json file
        // show response.json() and then 2nd .then()
            // kind of readable but ick, compare to .ajax()
            // point out that .then() actually returns a promise
            // and USING the data needs to happen in the .then() handler FOR NOW
        // also put catch and a finally on it just for grins
        // just log stuff in finally
        // in catch, check for empty data array and show Promise.reject("no data")
    fetch("docrob/data/inventory.json")
        .then(function(result) {
            console.log("data is not ready to be used here");
            return result.json();
        }).then(function(data) {
            console.log(data);
            if(data.length === 0) {
                return Promise.reject("no data");
            }
        }).catch(function(error) {
            console.log("An error occurred: " + error);
        });


    // writing a function that returns a promise
        // good to put specialized code inside a function, but using .then on the returned promise is ugly
    getInventory()
        .then(function(data) {
            console.log(data);
        });

    function getInventory() {
        return fetch("docrob/data/inventory.json")
            .then(function(result) {
                return result.json();
            })
    }

    // await/async
      console.log(await getInventory());

    // custom promises? ok, just go over the example in the curriculum. copy, paste it, run it. explain
        // neat, but also point out that never seen custom promises in capstones

  })();
</script>
</body>
</html>